<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>正解スコアボード - 全試験回</title>
    <link rel="stylesheet" href="admin.css">
    <script src="scoreboard.js"></script>
    <style>
        body {
            padding: 20px;
            background: #f4f5fb;
        }

        .scoreboard-section {
            margin-bottom: 40px;
            page-break-after: always;
        }

        .scoreboard-section h2 {
            margin: 20px 0 10px;
            font-size: 1.5rem;
            color: #333;
        }

        @media print {
            .scoreboard-section {
                page-break-after: always;
            }
        }
    </style>
</head>

<body>
    <h1>正解スコアボード - 全試験回</h1>

    <!-- 試験イ 第1回 -->
    <div class="scoreboard-section">
        <h2>試験イ 第1回（先鋒戦）</h2>
        <div id="scoreboard_I_1" class="scoreboard"></div>
    </div>

    <!-- 試験イ 第2回 -->
    <div class="scoreboard-section">
        <h2>試験イ 第2回（中堅戦）</h2>
        <div id="scoreboard_I_2" class="scoreboard"></div>
    </div>

    <!-- 試験イ 第3回 -->
    <div class="scoreboard-section">
        <h2>試験イ 第3回（大将戦）</h2>
        <div id="scoreboard_I_3" class="scoreboard"></div>
    </div>

    <!-- 試験ロ 第1回 -->
    <div class="scoreboard-section">
        <h2>試験ロ 第1回（先鋒戦）</h2>
        <div id="scoreboard_B_1" class="scoreboard"></div>
    </div>

    <!-- 試験ロ 第2回 -->
    <div class="scoreboard-section">
        <h2>試験ロ 第2回（次鋒戦）</h2>
        <div id="scoreboard_B_2" class="scoreboard"></div>
    </div>

    <!-- 試験ロ 第3回 -->
    <div class="scoreboard-section">
        <h2>試験ロ 第3回（中堅戦）</h2>
        <div id="scoreboard_B_3" class="scoreboard"></div>
    </div>

    <!-- 試験ロ 第4回 -->
    <div class="scoreboard-section">
        <h2>試験ロ 第4回（副将戦）</h2>
        <div id="scoreboard_B_4" class="scoreboard"></div>
    </div>

    <!-- 試験ロ 第5回 -->
    <div class="scoreboard-section">
        <h2>試験ロ 第5回（大将戦）</h2>
        <div id="scoreboard_B_5" class="scoreboard"></div>
    </div>

    <script>
        function parseScore(scoreStr) {
            const parts = scoreStr.split('-').map(s => s.trim());
            const parseSide = (s) => {
                const m = s.match(/^(\d+)(?:\+(\d+))?$/);
                return { work: parseInt(m[1]), app: parseInt(m[2] || '0') };
            };
            const red = parseSide(parts[0]);
            const white = parseSide(parts[1]);
            return {
                red_work: red.work,
                red_app: red.app,
                red_total: red.work + red.app,
                white_work: white.work,
                white_app: white.app,
                white_total: white.work + white.app
            };
        }

        function calculateFlags(s) {
            // 勝敗判定：合計点が同じ場合は作品点で判定
            if (s.red_total > s.white_total) {
                s.red_flag = true;
                s.white_flag = false;
            } else if (s.white_total > s.red_total) {
                s.red_flag = false;
                s.white_flag = true;
            } else {
                // 合計同点の場合は作品点で判定
                if (s.red_work > s.white_work) {
                    s.red_flag = true;
                    s.white_flag = false;
                } else if (s.white_work > s.red_work) {
                    s.red_flag = false;
                    s.white_flag = true;
                } else {
                    // 同点同作品点の場合も両方に星
                    s.red_flag = true;
                    s.white_flag = true;
                }
            }
            return s;
        }

        const judgesMap = {
            '1': 'デモ 一郎',
            '2': 'デモ 次郎',
            '3': 'デモ 三郎',
            '4': 'デモ 四郎',
            '5': 'デモ 五郎',
            '6': 'デモ 六郎',
            '7': 'デモ 七郎'
        };

        const expectedIds = ['1', '2', '3', '4', '5', '6', '7'];

        // 全試験回のスコアデータ
        const allScores = {
            I_1: {
                '1': '6+1 - 8', '2': '7 - 9+2', '3': '8+2 - 6', '4': '5 - 8+1',
                '5': '9+1 - 7', '6': '10 - 6+2', '7': '6+2 - 9'
            },
            I_2: {
                '1': '8 - 5+2', '2': '6+1 - 5', '3': '9 - 10+1', '4': '10+2 - 9',
                '5': '7 - 5+2', '6': '8+1 - 7', '7': '5 - 7+1'
            },
            I_3: {
                '1': '9+2 - 10', '2': '8 - 8+1', '3': '5+1 - 7', '4': '7 - 6+2',
                '5': '6+2 - 9', '6': '5 - 9+1', '7': '10+1 - 8'
            },
            B_1: {
                '1': '7 - 6+1', '2': '9+2 - 10', '3': '6 - 8+2', '4': '8+1 - 5',
                '5': '10 - 8+1', '6': '7+2 - 8', '7': '9 - 5+2'
            },
            B_2: {
                '1': '10+1 - 9', '2': '5+1 - 6', '3': '7+2 - 5', '4': '9 - 7+1',
                '5': '8+2 - 6', '6': '6 - 5+2', '7': '7+1 - 6'
            },
            B_3: {
                '1': '5 - 7+2', '2': '10 - 7+2', '3': '9+1 - 9', '4': '6+2 - 10',
                '5': '5 - 10+2', '6': '9+1 - 10', '7': '8 - 10+1'
            },
            B_4: {
                '1': '8+2 - 6', '2': '7+2 - 8', '3': '10 - 6+1', '4': '5+1 - 8',
                '5': '9+1 - 5', '6': '8 - 6+1', '7': '6+2 - 7'
            },
            B_5: {
                '1': '9 - 9+1', '2': '6 - 9+1', '3': '8 - 7+2', '4': '7 - 9+2',
                '5': '6 - 7+1', '6': '5+2 - 7', '7': '9 - 8+2'
            }
        };

        // 各試験回のスコアボードを生成
        const configs = [
            { id: 'I_1', label: 'テストイ', bout: '先鋒戦', red: '実証実験学園Ａ', white: '実証実験学園Ｂ' },
            { id: 'I_2', label: 'テストイ', bout: '中堅戦', red: '実証実験学園Ａ', white: '実証実験学園Ｂ' },
            { id: 'I_3', label: 'テストイ', bout: '大将戦', red: '実証実験学園Ａ', white: '実証実験学園Ｂ' },
            { id: 'B_1', label: 'テストロ', bout: '先鋒戦', red: '実証実験学園Ｃ', white: '実証実験学園Ｄ' },
            { id: 'B_2', label: 'テストロ', bout: '次鋒戦', red: '実証実験学園Ｃ', white: '実証実験学園Ｄ' },
            { id: 'B_3', label: 'テストロ', bout: '中堅戦', red: '実証実験学園Ｃ', white: '実証実験学園Ｄ' },
            { id: 'B_4', label: 'テストロ', bout: '副将戦', red: '実証実験学園Ｃ', white: '実証実験学園Ｄ' },
            { id: 'B_5', label: 'テストロ', bout: '大将戦', red: '実証実験学園Ｃ', white: '実証実験学園Ｄ' }
        ];

        configs.forEach(config => {
            const scoreStrings = allScores[config.id];
            const subMap = {};

            for (let id in scoreStrings) {
                const s = parseScore(scoreStrings[id]);
                calculateFlags(s);
                subMap[id] = s;
            }

            buildScoreboard(expectedIds, judgesMap, subMap, {
                matchLabel: config.label,
                boutLabelFull: config.bout,
                redTeamName: config.red,
                whiteTeamName: config.white
            }, document.getElementById('scoreboard_' + config.id));
        });
    </script>
</body>

</html>